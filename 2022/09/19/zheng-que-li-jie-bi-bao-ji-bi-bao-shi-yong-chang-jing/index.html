<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="博客"><title>正确理解闭包及闭包使用场景 | 独白</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">正确理解闭包及闭包使用场景</h1><a id="logo" href="/.">独白</a><p class="description">真正的大师永远怀着一颗学徒的心</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/timeline/"><i class="fa fa-history"> 历史</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">正确理解闭包及闭包使用场景</h1><div class="post-meta">2022-09-19<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.9k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 7</span><span class="post-meta-item-text"> 分钟</span></span></span></div><a class="disqus-comment-count" href="/2022/09/19/zheng-que-li-jie-bi-bao-ji-bi-bao-shi-yong-chang-jing/#vcomment"><span class="waline-comment-count" id="/2022/09/19/zheng-que-li-jie-bi-bao-ji-bi-bao-shi-yong-chang-jing/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-text">一、闭包的特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E5%AE%9A%E4%B9%89%E5%8F%8A%E5%85%B6%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">二、闭包的定义及其优缺点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%B5%8C%E5%A5%97%E5%87%BD%E6%95%B0%E7%9A%84%E9%97%AD%E5%8C%85"><span class="toc-text">三、嵌套函数的闭包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81javascript%E7%9A%84%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%8E%9F%E7%90%86"><span class="toc-text">四、javascript的垃圾回收原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8%E9%97%AD%E5%8C%85%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">五、使用闭包的好处</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8%E9%97%AD%E5%8C%85%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-text">六、使用闭包的情况</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-return-%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">6.1 return 函数作为返回值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0%E8%A2%AB%E4%BC%A0%E9%80%92"><span class="toc-text">6.2 函数作为参数被传递</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-IIFE%EF%BC%88%E8%87%AA%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%EF%BC%89"><span class="toc-text">6.3 IIFE（自执行函数）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E5%BE%AA%E7%8E%AF%E8%B5%8B%E5%80%BC"><span class="toc-text">6.4 循环赋值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-text">6.5 使用回调函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98"><span class="toc-text">七、内存泄露问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E9%97%AD%E5%8C%85%E7%9A%84%E9%94%80%E6%AF%81"><span class="toc-text">八、闭包的销毁</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E6%96%B0%E5%A2%9E"><span class="toc-text">九、新增</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%BF%85%E5%88%B7%E9%A2%98"><span class="toc-text">十、必刷题</span></a></li></ol></div></div><div class="post-content"><p><img src="https://img-blog.csdnimg.cn/00d7a66689c0458fbee6649a256abf82.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU2VyZW5kaXBpdHlN,size_20,color_FFFFFF,t_70,g_se,x_16" alt="请添加图片描述"></p>
<h1 id="一、闭包的特性"><a href="#一、闭包的特性" class="headerlink" title="一、闭包的特性"></a>一、闭包的特性</h1><ol>
<li>函数嵌套函数 </li>
<li>函数内部可以引用外部的参数和变量 </li>
<li>参数和变量不会被垃圾回收机制回收</li>
</ol>
<h1 id="二、闭包的定义及其优缺点"><a href="#二、闭包的定义及其优缺点" class="headerlink" title="二、闭包的定义及其优缺点"></a>二、闭包的定义及其优缺点</h1><p><strong>定义：</strong><br>闭包 是指有权访问另一个函数作用域中的变量的函数，创建闭包的最常见的方式就是在一个函数内创建另一个函数，通过另一个函数访问这个函数的局部变量</p>
<p><strong>缺点：</strong><br>闭包的缺点就是常驻内存，会增大内存使用量，使用不当很容易造成内存泄露。</p>
<p><strong>存在闭包的原因：</strong><br>内部的函数存在外部作用域的引用就会导致闭包。</p>
<p>闭包是javascript语言的一大特点，主要应用闭包场合主要是为了：设计私有的方法和变量。<br>一般函数执行完毕后，局部活动对象就被销毁，内存中仅仅保存全局作用域。但闭包的情况不同！</p>
<h1 id="三、嵌套函数的闭包"><a href="#三、嵌套函数的闭包" class="headerlink" title="三、嵌套函数的闭包"></a>三、嵌套函数的闭包</h1><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function aaa() {  </span><br><span class="line">  var a = 1;  </span><br><span class="line">  return function(){</span><br><span class="line">   alert(a++)</span><br><span class="line">  };  </span><br><span class="line">}         </span><br><span class="line">var fun = aaa();  </span><br><span class="line">fun();// 1 执行后 a++，，然后a还在~  </span><br><span class="line">fun();// 2   </span><br><span class="line">fun = null;//a被回收！！ </span><br></pre></td></tr></tbody></table></figure>
<p><strong>闭包</strong>会使变量始终保存在内存中，如果不当使用会增大内存消耗。</p>
<h1 id="四、javascript的垃圾回收原理"><a href="#四、javascript的垃圾回收原理" class="headerlink" title="四、javascript的垃圾回收原理"></a>四、javascript的垃圾回收原理</h1><p> 不同的编程语言管理内存的方式各不相同。一些高级编程语言的解释器或运行时嵌入了“垃圾回收器”，通过算法可自动的进行内存的分配与释放管理（比如 JavaScript、Java、C# 等）。另一些则寄希望于开发者自己手动地进行内存的分配与释放管理（比如 C/C++ 等）。<br>而JavaScript 是通过垃圾回收器来进行内存管理，其实现是基于标记-清除算法。而这个算法把“对象是否不再需要”简化定义为“对象是否可以获得”。其假定设置一个叫做根（root）的对象（在Javascript里，根是全局对象）。在标记过程，垃圾回收器将定期从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象……从根开始，垃圾回收器将找到所有可以获得的对象和收集所有不能获得的对象。标记完成后就进行清除过程。（可达内存被标记，其余的被当作垃圾回收。）</p>
<p>（1）、在javascript中，如果一个对象不再被引用，那么这个对象就会被GC回收；<br>（2）、如果两个对象互相引用，而不再被第3者所引用，那么这两个互相引用的对象也会被回收。</p>
<h1 id="五、使用闭包的好处"><a href="#五、使用闭包的好处" class="headerlink" title="五、使用闭包的好处"></a>五、使用闭包的好处</h1><p>那么使用闭包有什么好处呢？使用闭包的好处是：</p>
<ol>
<li>希望一个变量长期驻扎在内存中 </li>
<li>避免全局变量的污染 </li>
<li>私有成员的存在</li>
</ol>
<h1 id="六、使用闭包的情况"><a href="#六、使用闭包的情况" class="headerlink" title="六、使用闭包的情况"></a>六、使用闭包的情况</h1><p>你只需要知道应用的两种情况即可——函数作为返回值，函数作为参数传递。</p>
<h2 id="6-1-return-函数作为返回值"><a href="#6-1-return-函数作为返回值" class="headerlink" title="6.1 return 函数作为返回值"></a>6.1 return 函数作为返回值</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function fn(){</span><br><span class="line">  var max=10;</span><br><span class="line">  </span><br><span class="line">  return function bar(x) {</span><br><span class="line">    if(x&gt; max){</span><br><span class="line">      console.log(x)</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">var f1=fn();</span><br><span class="line">f1(15);</span><br></pre></td></tr></tbody></table></figure>
<p>如上代码，bar函数作为返回值，赋值给f1变量。执行f1(15)时，用到了fn作用域下的max变量的值。至于如何跨作用域取值，可以参考上一节。</p>
<h2 id="6-2-函数作为参数被传递"><a href="#6-2-函数作为参数被传递" class="headerlink" title="6.2 函数作为参数被传递"></a>6.2 函数作为参数被传递</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var max =10,</span><br><span class="line">fn = function(x){</span><br><span class="line">	if(x &gt; max){</span><br><span class="line">    console.log(x);</span><br><span class="line">  }</span><br><span class="line">};</span><br><span class="line">(function (f) {</span><br><span class="line">  var max =100;</span><br><span class="line">  f(15);</span><br><span class="line">})(fn);</span><br></pre></td></tr></tbody></table></figure>
<p>如上代码中，fn函数作为一个参数被传递进入另一个函数，赋值给f参数。执行f(15)时，max变量的取值是10，而不是100。</p>
<p>讲自由变量跨作用域取值时，曾经强调过：要去创建这个函数的作用域取值，而不是“父作用域”。理解了这一点，以上两端代码中，自由变量如何取值应该比较简单。</p>
<h2 id="6-3-IIFE（自执行函数）"><a href="#6-3-IIFE（自执行函数）" class="headerlink" title="6.3 IIFE（自执行函数）"></a>6.3 IIFE（自执行函数）</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var n = '林一一';</span><br><span class="line">(function p(){</span><br><span class="line">    console.log(n)</span><br><span class="line">})()</span><br><span class="line">/* 输出</span><br><span class="line">*   林一一</span><br><span class="line">/</span><br></pre></td></tr></tbody></table></figure>
<h2 id="6-4-循环赋值"><a href="#6-4-循环赋值" class="headerlink" title="6.4 循环赋值"></a>6.4 循环赋值</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for(var i = 0; i&lt;10; i++){</span><br><span class="line">  (function(j){</span><br><span class="line">       setTimeout(function(){</span><br><span class="line">        console.log(j)</span><br><span class="line">    }, 1000) </span><br><span class="line">  })(i)</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>因为存在闭包的原因上面能依次输出1~10，闭包形成了10个互不干扰的私有作用域。将外层的自执行函数去掉后就不存在外部作用域的引用了，输出的结果就是连续的 10。为什么会连续输出10，因为 JS 是单线程的遇到异步的代码不会先执行(会入栈)，等到同步的代码执行完 i++ 到 10时，异步代码才开始执行此时的 i=10 输出的都是 10。</p>
<h2 id="6-5-使用回调函数"><a href="#6-5-使用回调函数" class="headerlink" title="6.5 使用回调函数"></a>6.5 使用回调函数</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">window.name = '林一一'</span><br><span class="line">setTimeout(function timeHandler(){</span><br><span class="line">  console.log(window.name);</span><br><span class="line">}, 100)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="七、内存泄露问题"><a href="#七、内存泄露问题" class="headerlink" title="七、内存泄露问题"></a>七、内存泄露问题</h1><p>什么是内存泄漏？<br>应用程序不再用到的内存，由于某些原因，没有及时释放，就叫做内存泄漏。</p>
<p>由于IE的js对象和DOM对象使用不同的垃圾收集方法，因此闭包在IE中会导致内存泄露问题，也就是无法销毁驻留在内存中的元素</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function closure(){</span><br><span class="line">    var oDiv = document.getElementById('oDiv');//oDiv用完之后一直驻留在内存中</span><br><span class="line">    oDiv.onclick = function () {</span><br><span class="line">        alert('oDiv.innerHTML');//这里用oDiv导致内存泄露</span><br><span class="line">    };</span><br><span class="line">}</span><br><span class="line">closure();</span><br><span class="line">//最后应将oDiv解除引用来避免内存泄露</span><br><span class="line"></span><br><span class="line">function closure(){</span><br><span class="line">    var oDiv = document.getElementById('oDiv');</span><br><span class="line">    var test = oDiv.innerHTML;</span><br><span class="line">    oDiv.onclick = function () {</span><br><span class="line">        alert(test);</span><br><span class="line">    };</span><br><span class="line">    oDiv = null;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h1 id="八、闭包的销毁"><a href="#八、闭包的销毁" class="headerlink" title="八、闭包的销毁"></a>八、闭包的销毁</h1><pre><code>const outerFn = () =&gt; {
    let count = 0;
    const innerFn = () =&gt; {
        console.log('count', ++count);
    }
    return innerFn;
}

let closure = outerFn(); // 创建第一个闭包
 closure();
closure();
closure = outerFn(); // 销毁第一个闭包，创建第二个闭包
closure();
closure();
closure = null; // 销毁闭包
// 输出结果：
// count 1
// count 2
// count 1
// count 2
</code></pre>
<p>由上面的例子可以看出来，当第二次为closure赋值后，再次执行2次closure()时，count的结果并不会变成3，4，而是又变回了1，2。<br>这表示着，当第二次赋值的时候，第一个闭包就会被垃圾回收销毁掉，而第三次赋值为null时，则是把第二次的闭包也销毁了。</p>
<p>简单的总结：</p>
<ul>
<li>关于闭包的销毁<ul>
<li>可在模块或应用结束后来进行空赋值处理，进行销毁，比如上面的：closure = null</li>
<li>等待页面被关闭，才会被销毁。</li>
</ul>
</li>
<li>至于为什么会要这么处理才会被销毁呢？具体的话可以网上找一下 javascript 回收机制，有兴趣的童鞋可以去了解了解。</li>
</ul>
<h1 id="九、新增"><a href="#九、新增" class="headerlink" title="九、新增"></a>九、新增</h1><p>很多初学者学了闭包后，可能也不懂到底在哪里才有用到，甚至不懂闭包到底有啥用。<br>其实你写的每一个js函数都是闭包，一个js函数的顶层作用域就是window对象，js的执行环境本身就是一个scope（浏览器的window/node的global），我们通常称之为全局作用域。每个函数，不论多深，都可以认为是全局scope的子作用域，可以理解为闭包。</p>
<h1 id="十、必刷题"><a href="#十、必刷题" class="headerlink" title="十、必刷题"></a>十、必刷题</h1><p>一、for 循环和闭包(号称必刷题)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var data = [];</span><br><span class="line"></span><br><span class="line">for (var i = 0; i &lt; 3; i++) {</span><br><span class="line">  data[i] = function () {</span><br><span class="line">    console.log(i);</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">data[0]();</span><br><span class="line">data[1]();</span><br><span class="line">data[2]()</span><br><span class="line">/* 输出</span><br><span class="line">    3</span><br><span class="line">    3</span><br><span class="line">    3</span><br><span class="line">/</span><br></pre></td></tr></tbody></table></figure>
<p>这里的 i 是全局下的 i，共用一个作用域，当函数被执行的时候这时的 i=3，导致输出的结构都是3。</p>
<p>● 写法1：自执行函数和闭包(使用闭包改善上面的写法达到预期效果)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">var data = [];</span><br><span class="line"></span><br><span class="line">for (var i = 0; i &lt; 3; i++) {</span><br><span class="line">    (function(j){</span><br><span class="line">      setTimeout( data[j] = function () {</span><br><span class="line">        console.log(j);</span><br><span class="line">      }, 0)</span><br><span class="line">    })(i)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">data[0]();</span><br><span class="line">data[1]();</span><br><span class="line">data[2]()</span><br></pre></td></tr></tbody></table></figure>
<p>● 写法2：使用 let</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var data = [];</span><br><span class="line"></span><br><span class="line">for (let i = 0; i &lt; 3; i++) {</span><br><span class="line">  data[i] = function () {</span><br><span class="line">    console.log(i);</span><br><span class="line">  };</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">data[0]();</span><br><span class="line">data[1]();</span><br><span class="line">data[2]()</span><br></pre></td></tr></tbody></table></figure></div><div class="tags"><a href="/tags/javascript"><i class="fa fa-tag">javascript</i></a><a href="/tags/前端"><i class="fa fa-tag">前端</i></a></div><div class="post-nav"><a class="pre" href="/2022/09/19/shi-yong-nvm-an-zhuang-nodejs-bing-jie-jue-npm-xia-zai-yi-lai-shi-xiao-wen-ti-zui-quan-liu-cheng/">使用NVM安装NodeJS并解决npm下载依赖失效问题（最全流程）</a><a class="next" href="/2022/09/19/qian-hou-duan-fen-chi-kai-fa-zhi-quan-xian-pian-ji-vue-lu-you-shou-wei-next-next-to-replace-true-next-shuo-ming/">前后端分离开发之权限篇及VUE路由守卫</a></div><div id="waline"></div><script src="//unpkg.com/@waline/client@v2/dist/waline.js"></script><link rel="stylesheet" type="text/css" href="//unpkg.com/@waline/client@v2/dist/waline.css"><script>let metaInfo = ['nick', 'mail', 'link']
let requiredMeta = 'nick,mail,link'.split(',').filter(item => {
  return metaInfo.indexOf(item) > -1
})
Waline.init({
  el: '#waline',
  comment: true,
  serverURL: 'https://waline.cirry.cn:66666',
  pageSize: '20',
  wordLimit: '500',
  requiredMeta,
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img src="/img/yibo.jpg"/></a><p>To be a better man.</p><a class="info-icon" href="https://www.yuque.com/dubai-eneou/gxyabb" title="语雀" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="2606734623@qq.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/CatWhy" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/rss.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/elementui/" style="font-size: 15px;">elementui</a> <a href="/tags/vue-js/" style="font-size: 15px;">vue.js</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80/" style="font-size: 15px;">开发语言</a> <a href="/tags/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/" style="font-size: 15px;">原型模式</a> <a href="/tags/react-js/" style="font-size: 15px;">react.js</a> <a href="/tags/typescript/" style="font-size: 15px;">typescript</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/npm/" style="font-size: 15px;">npm</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/%E5%8A%A8%E7%94%BB/" style="font-size: 15px;">动画</a> <a href="/tags/css3/" style="font-size: 15px;">css3</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/vue-shi-xian-word-wen-dang-zai-xian-yu-lan-gong-neng-nei-wang-wai-wang/">Vue实现Word文档在线预览功能（内网、外网）！！！</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/vue-zhong-shi-yong-el-data-picker-bao-cuo-avoid-mutating-a-prop-directly-since-the-value-will-be-overwrite/">Vue中使用el-data-picker报错 Avoid mutating a prop directly since the value will be overwrite</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/vue-xiang-mu-zhong-shi-yong-dai-ti-src-bing-zai-vscode-zhong-kai-qi-lu-jing-zi-dong-ti-shi/">Vue项目中使用@代替src——并在VScode中开启@路径自动提示</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/guan-yu-vue-xin-zeng-attrs-listeners-inheritattrs/">关于vue新增 - inheritAttrs & listeners & attrs</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/vue-shi-ji-yun-yong-chu-li-token-guo-qi/">vue实际运用：处理token过期</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/vant-uploader-tu-pian-shang-chuan-gen-ju-hou-duan-url-hui-xian-wen-ti/">Vant Uploader 图片上传，根据后端url回显问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/react-sheng-ming-zhou-qi/">React生命周期</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/npm-run-eject-bao-cuo-this-git-repository-has-untracked-files-or-uncommitted-changes-jie-jue-fang-an/">npm run eject 报错This git repository has untracked files or uncommitted changes解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/shi-yong-nvm-an-zhuang-nodejs-bing-jie-jue-npm-xia-zai-yi-lai-shi-xiao-wen-ti-zui-quan-liu-cheng/">使用NVM安装NodeJS并解决npm下载依赖失效问题（最全流程）</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/19/zheng-que-li-jie-bi-bao-ji-bi-bao-shi-yong-chang-jing/">正确理解闭包及闭包使用场景</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverURL="https://waline.cirry.cn:66666" count="6" src="/js/recent-comments.js?v=1.0.0" async="async"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"> <div> <span>Copyright  </span> 
<span class="fa fa-copyright">2022  </span> 
<a href="/." rel="nofollow">独白</a> <a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">|  你自己的备案号 </a> </div><div class="footer-remark"> <div class="github-badge"> <a target="_blank" href="https:hexo.io" rel="nofollow noopener"> <span class="badge-subject">Powered by  </span><span class="badge-value color-clear-chill">Hexo  </span></a></div><div class="github-badge"> <a target="_blank" href="https:hexo.io" rel="nofollow noopener"> <span class="badge-subject">Theme  </span><span class="badge-value color-ufo-green">Maupassant  </span></a></div><div class="github-badge"> <span class="badge-subject">总访问量  </span><span class="badge-value color-watermelon" id="busuanzi_value_site_pv"> </span></div><div class="github-badge"> <span class="badge-subject">总访问人数  </span><span class="badge-value color-coral" id="busuanzi_value_site_uv"> </span></div><div class="github-badge"></div></div></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/love.js?v=1.0.0"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/external.css?v=1.0.0"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>